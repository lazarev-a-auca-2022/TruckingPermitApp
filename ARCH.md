# Truck Permit App Architecture

## Overview
This document details the architecture for the Minimum Viable Product (MVP) of a trucking permit management application, designed to process state-specific trucking permits and convert them into navigable routes for Google Maps and Garmin navigators. The app supports permit document uploads, route parsing, visualization, and export functionality.

## Objectives
- Enable users to upload and parse state-specific permit documents.
- Convert permit route descriptions into actionable navigation points.
- Visualize routes on Google Maps with key waypoints.
- Provide a basic interface for multi-state route planning.
- Minimize manual effort in interpreting permit details.

## System Architecture

### Frontend
- **Technology**: React.js (web), React Native (mobile)
- **Components**:
  - **Upload Interface**: Drag-and-drop file upload for PDF, image, and text files.
  - **Route Display**: Text-based route details and Google Maps visualization.
  - **Navigation Buttons**: Open route in Google Maps, export to Garmin (GPX).
  - **State Selector**: Dropdown for selecting supported states (Illinois, Wisconsin, Missouri, North Dakota, Indiana).
- **Styling**: Tailwind CSS for consistent UI across web and mobile.
- **Features**:
  - Responsive design for web and mobile compatibility.
  - Real-time feedback on file upload and parsing status.
  - Error handling for invalid file formats or parsing failures.

### Backend
- **Technology**: Node.js with Express
- **API Endpoints**:
  - `POST /upload`: Handles file uploads (PDF, image, text).
  - `GET /routes/:id`: Retrieves parsed route details.
  - `GET /maps-url/:id`: Generates Google Maps URL with waypoints.
  - `GET /gpx/:id`: Exports route as GPX file for Garmin devices.
  - `GET /states`: Lists supported states.
- **Authentication**: JWT-based user authentication for secure access.
- **File Handling**: Multer for processing file uploads, with temporary storage on server.

### Parsing Engine
- **Technology**: Custom NLP module (built with Node.js and Python)
- **Functionality**:
  - Extracts key data: start/end points, waypoints, distances, restrictions.
  - Supports state-specific formats for Illinois, Wisconsin, Missouri, North Dakota, and Indiana.
  - Uses regex and NLP techniques to handle semi-structured permit text.
- **Fallback**: Manual override interface for users to correct parsing errors.
- **Dependencies**: Tesseract.js (for OCR on images), pdf2json (for PDF parsing).

### Mapping Service
- **Technology**: Google Maps API
- **Features**:
  - Converts parsed waypoints into GPS coordinates or addresses.
  - Generates shareable Google Maps URLs for route visualization.
  - Supports up to 25 waypoints per route (Google Maps limit).
- **Optimization**: Caching of API responses to reduce rate limit issues.

### Database
- **Technology**: MongoDB
- **Schema**:
  - **Users**: Stores user credentials and session data.
  - **Routes**: Stores parsed route data (start/end points, waypoints, restrictions).
  - **Files**: Metadata for uploaded permit documents (file type, size, upload date).
- **Security**: Encrypted storage for sensitive data (e.g., permit details).

### Export Module
- **Technology**: GPX library (e.g., `gpx-builder` for Node.js)
- **Functionality**:
  - Converts parsed route data into GPX format.
  - Ensures compatibility with Garmin navigators.
  - Includes waypoints, distances, and restrictions.

## Data Flow
1. **Upload**: User uploads permit document via frontend.
2. **Processing**: Backend stores file temporarily, triggers parsing engine.
3. **Parsing**: NLP module extracts route data, stores in MongoDB.
4. **Visualization**: Frontend retrieves parsed data, displays text and map view.
5. **Export**: User requests Google Maps URL or GPX file, generated by backend.

## Non-Functional Requirements
- **Performance**: Parsing and conversion completed within 10 seconds.
- **Reliability**: 99% accuracy for standard permit formats.
- **Security**: HTTPS for API calls, encrypted file storage.
- **Scalability**: Horizontal scaling for backend using Docker containers.
- **Compatibility**: Supports modern browsers (Chrome, Firefox, Safari) and iOS/Android devices.

## Development Milestones
1. **Environment Setup** 
   - Configure React.js, React Native, Node.js, MongoDB.
   - Design UI mockups for upload and route display.
2. **Parsing Engine**
   - Develop NLP module for 5 states.
   - Test parsing accuracy with sample permits.
3. **Integration** 
   - Integrate Google Maps API for visualization.
   - Implement GPX export for Garmin compatibility.
4. **Testing**
   - Unit tests for parsing engine and API endpoints.
   - End-to-end tests for upload-to-export flow.
5. **Deployment** 
   - Deploy to cloud provider (e.g., AWS or Heroku).
   - Monitor performance and fix bugs.

## Risks and Mitigation
- **Inconsistent Permit Formats**:
  - Mitigation: Flexible parsing engine with regex and NLP, plus manual override UI.
- **API Rate Limits**:
  - Mitigation: Cache Google Maps API responses, batch requests where possible.
- **Parsing Errors**:
  - Mitigation: Comprehensive testing with diverse permit samples, user feedback loop.

## Assumptions
- Users have reliable internet for API calls and map integration.
- Permit documents follow semi-structured formats with identifiable route details.
- Initial focus on 5 states, with modular design for future expansion.

## Dependencies
- **Frontend**: React.js, React Native, Tailwind CSS, Axios.
- **Backend**: Node.js, Express, Multer, JWT.
- **Parsing**: Tesseract.js, pdf2json, Python (for NLP).
- **Mapping**: Google Maps API.
- **Database**: MongoDB, Mongoose.
- **Export**: gpx-builder.
- **DevOps**: Docker, AWS/Heroku, Jest (testing).

## Future Considerations
- Expand to all 48 contiguous U.S. states.
- Add offline parsing capabilities for mobile users.
- Integrate real-time traffic data from Google Maps.
- Support additional navigator formats (e.g., TomTom).
